
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>09 Visualizations Brisbane</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        h1, h2 { color: #333; }
        .code, .output, .error {
            background-color: #f5f5f5;
            padding: 1em;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .code { background-color: #2d2d2d; color: #f1f1f1; }
        .error { background-color: #fff0f0; color: #c00; }
    </style>
</head>
<body>
    <h1>09 Visualizations Brisbane</h1>
    <h2>Code</h2>
    <pre class="code"><code>
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import joblib
from sklearn.model_selection import cross_val_predict
from sklearn.metrics import roc_curve, auc, confusion_matrix, precision_recall_curve
import os

# Load the preprocessed data
df = pd.read_csv(r&quot;C:\Users\DELL\Desktop\predict\brisbane-water-quality-preprocessed.csv&quot;)

# Load the trained model
model = joblib.load(r&quot;C:\Users\DELL\Desktop\predict\water_quality_model_brisbane_xgb.joblib&quot;)

# Create the static directory if it doesn&#x27;t exist
static_dir = r&quot;C:\Users\DELL\Desktop\predict\app\static&quot;
if not os.path.exists(static_dir):
    os.makedirs(static_dir)

# Set the style
sns.set_style(&quot;whitegrid&quot;)
palette = &quot;plasma&quot;

# 1. Distribution of Numerical Features
plt.figure(figsize=(12, 7))
sns.histplot(df[&#x27;Turbidity&#x27;], kde=True, color=sns.color_palette(palette)[0])
plt.title(&#x27;Distribution of Turbidity (Brisbane)&#x27;, fontsize=16)
plt.tight_layout()
plt.savefig(os.path.join(static_dir, &#x27;brisbane_distribution_turbidity.png&#x27;))
plt.close()

plt.figure(figsize=(12, 7))
sns.histplot(df[&#x27;Dissolved Oxygen&#x27;], kde=True, color=sns.color_palette(palette)[1])
plt.title(&#x27;Distribution of Dissolved Oxygen (Brisbane)&#x27;, fontsize=16)
plt.tight_layout()
plt.savefig(os.path.join(static_dir, &#x27;brisbane_distribution_do.png&#x27;))
plt.close()

plt.figure(figsize=(12, 7))
sns.histplot(df[&#x27;pH&#x27;], kde=True, color=sns.color_palette(palette)[2])
plt.title(&#x27;Distribution of pH (Brisbane)&#x27;, fontsize=16)
plt.tight_layout()
plt.savefig(os.path.join(static_dir, &#x27;brisbane_distribution_ph.png&#x27;))
plt.close()

# 2. Target Variable Distribution
plt.figure(figsize=(10, 7))
sns.countplot(x=&#x27;Deterioration&#x27;, data=df, palette=palette)
plt.title(&#x27;Distribution of Target Variable (Deterioration - Brisbane)&#x27;, fontsize=16)
plt.tight_layout()
plt.savefig(os.path.join(static_dir, &#x27;brisbane_target_distribution.png&#x27;))
plt.close()

# 3. Feature Importance
feature_names = df.drop(columns=[&#x27;Deterioration&#x27;]).columns.tolist()
importances = model.feature_importances_
feature_importance_df = pd.DataFrame({&#x27;feature&#x27;: feature_names, &#x27;importance&#x27;: importances})
feature_importance_df = feature_importance_df.sort_values(by=&#x27;importance&#x27;, ascending=False)

plt.figure(figsize=(14, 9))
sns.barplot(x=&#x27;importance&#x27;, y=&#x27;feature&#x27;, data=feature_importance_df, palette=palette)
plt.title(&#x27;Feature Importance (Brisbane)&#x27;, fontsize=16)
plt.tight_layout()
plt.savefig(os.path.join(static_dir, &#x27;brisbane_feature_importance.png&#x27;))
plt.close()

# 4. Correlation Matrix
plt.figure(figsize=(12, 9))
sns.heatmap(df.drop(columns=[&#x27;Deterioration&#x27;]).corr(), annot=True, cmap=&#x27;coolwarm&#x27;, fmt=&quot;.2f&quot;)
plt.title(&#x27;Correlation Matrix of Numerical Features (Brisbane)&#x27;, fontsize=16)
plt.tight_layout()
plt.savefig(os.path.join(static_dir, &#x27;brisbane_correlation_heatmap.png&#x27;))
plt.close()

# 5. Model Evaluation Plots
X = df.drop(columns=[&#x27;Deterioration&#x27;])
y = df[&#x27;Deterioration&#x27;]

y_pred_proba = cross_val_predict(model, X, y, cv=3, method=&quot;predict_proba&quot;)[:, 1]
y_pred = cross_val_predict(model, X, y, cv=3)

# ROC-AUC Curve
fpr, tpr, _ = roc_curve(y, y_pred_proba)
roc_auc = auc(fpr, tpr)

plt.figure(figsize=(10, 7))
plt.plot(fpr, tpr, color=sns.color_palette(palette)[2], lw=2, label=&#x27;ROC curve (area = %0.2f)&#x27; % roc_auc)
plt.plot([0, 1], [0, 1], color=&#x27;navy&#x27;, lw=2, linestyle=&#x27;--&#x27;)
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel(&#x27;False Positive Rate&#x27;)
plt.ylabel(&#x27;True Positive Rate&#x27;)
plt.title(&#x27;Receiver Operating Characteristic (ROC) Curve (Brisbane)&#x27;, fontsize=16)
plt.legend(loc=&quot;lower right&quot;)
plt.tight_layout()
plt.savefig(os.path.join(static_dir, &#x27;brisbane_roc_auc_curve.png&#x27;))
plt.close()

# Confusion Matrix
cm = confusion_matrix(y, y_pred)
plt.figure(figsize=(10, 7))
sns.heatmap(cm, annot=True, fmt=&quot;d&quot;, cmap=palette)
plt.title(&#x27;Confusion Matrix (Brisbane)&#x27;, fontsize=16)
plt.ylabel(&#x27;Actual&#x27;)
plt.xlabel(&#x27;Predicted&#x27;)
plt.tight_layout()
plt.savefig(os.path.join(static_dir, &#x27;brisbane_confusion_matrix.png&#x27;))
plt.close()

# Precision-Recall Curve
precision, recall, _ = precision_recall_curve(y, y_pred_proba)

plt.figure(figsize=(10, 7))
plt.plot(recall, precision, color=sns.color_palette(palette)[4], lw=2)
plt.xlabel(&#x27;Recall&#x27;)
plt.ylabel(&#x27;Precision&#x27;)
plt.title(&#x27;Precision-Recall Curve (Brisbane)&#x27;, fontsize=16)
plt.tight_layout()
plt.savefig(os.path.join(static_dir, &#x27;brisbane_precision_recall_curve.png&#x27;))
plt.close()

print(&quot;Brisbane visualizations created and saved to app/static directory.&quot;)
</code></pre>
    
    <h2>Output</h2>
    <pre class="output"><code>Brisbane visualizations created and saved to app/static directory.
</code></pre>

    <h2>Errors</h2>
    <pre class="error"><code>C:\Users\DELL\Desktop\predict\notebooks\09_Visualizations_Brisbane.py:49: FutureWarning: 

Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.

  sns.countplot(x=&#x27;Deterioration&#x27;, data=df, palette=palette)
C:\Users\DELL\Desktop\predict\notebooks\09_Visualizations_Brisbane.py:62: FutureWarning: 

Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.

  sns.barplot(x=&#x27;importance&#x27;, y=&#x27;feature&#x27;, data=feature_importance_df, palette=palette)
</code></pre>

</body>
</html>
