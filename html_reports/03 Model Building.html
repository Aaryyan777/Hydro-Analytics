
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>03 Model Building</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        h1, h2 { color: #333; }
        .code, .output, .error {
            background-color: #f5f5f5;
            padding: 1em;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .code { background-color: #2d2d2d; color: #f1f1f1; }
        .error { background-color: #fff0f0; color: #c00; }
    </style>
</head>
<body>
    <h1>03 Model Building</h1>
    <h2>Code</h2>
    <pre class="code"><code>import pandas as pd
from sklearn.model_selection import StratifiedKFold, cross_val_score
from sklearn.ensemble import RandomForestClassifier
from sklearn.preprocessing import OneHotEncoder
import joblib

# Load the preprocessed data
df = pd.read_csv(r&quot;C:\Users\DELL\Desktop\predict\drinking-water-quality-preprocessed.csv&quot;)

# Separate features and target
X = df.drop(columns=[&#x27;Deterioration&#x27;])
y = df[&#x27;Deterioration&#x27;]

# One-hot encode the &#x27;Sample class&#x27; column
encoder = OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)
X_encoded = encoder.fit_transform(X[[&#x27;Sample class&#x27;]])
X_encoded_df = pd.DataFrame(X_encoded, columns=encoder.get_feature_names_out([&#x27;Sample class&#x27;]))
X = pd.concat([X.drop(columns=[&#x27;Sample class&#x27;]), X_encoded_df], axis=1)

# Define the model
model = RandomForestClassifier(class_weight=&#x27;balanced&#x27;, random_state=42)

# Define the cross-validation strategy
cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)

# Evaluate the model
metrics = [&#x27;accuracy&#x27;, &#x27;f1&#x27;, &#x27;precision&#x27;, &#x27;recall&#x27;]
for metric in metrics:
    scores = cross_val_score(model, X, y, cv=cv, scoring=metric)
    print(f&quot;Mean {metric}: {scores.mean():.4f}&quot;)

# Train the final model
model.fit(X, y)

# Save the model
joblib.dump(model, &#x27;water_quality_model.joblib&#x27;)
joblib.dump(encoder, &#x27;encoder.joblib&#x27;)

print(&quot;\nModel training complete. Model saved to water_quality_model.joblib&quot;)
</code></pre>
    
    <h2>Output</h2>
    <pre class="output"><code>Mean accuracy: 0.9961
Mean f1: 0.0000
Mean precision: 0.0000
Mean recall: 0.0000

Model training complete. Model saved to water_quality_model.joblib
</code></pre>

    <h2>Errors</h2>
    <pre class="error"><code>C:\Users\DELL\AppData\Roaming\Python\Python311\site-packages\sklearn\metrics\_classification.py:1565: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f&quot;{metric.capitalize()} is&quot;, len(result))
</code></pre>

</body>
</html>
