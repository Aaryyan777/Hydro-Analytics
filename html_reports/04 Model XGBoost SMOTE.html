
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>04 Model XGBoost SMOTE</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        h1, h2 { color: #333; }
        .code, .output, .error {
            background-color: #f5f5f5;
            padding: 1em;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .code { background-color: #2d2d2d; color: #f1f1f1; }
        .error { background-color: #fff0f0; color: #c00; }
    </style>
</head>
<body>
    <h1>04 Model XGBoost SMOTE</h1>
    <h2>Code</h2>
    <pre class="code"><code>
import pandas as pd
from sklearn.model_selection import StratifiedKFold, cross_val_score
from sklearn.preprocessing import OneHotEncoder
from imblearn.over_sampling import SMOTE
from xgboost import XGBClassifier
import joblib

# Load the preprocessed data
df = pd.read_csv(r&quot;C:\Users\DELL\Desktop\predict\drinking-water-quality-preprocessed.csv&quot;)

# Separate features and target
X = df.drop(columns=[&#x27;Deterioration&#x27;])
y = df[&#x27;Deterioration&#x27;]

# One-hot encode the &#x27;Sample class&#x27; column
encoder = OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse_output=False)
X_encoded = encoder.fit_transform(X[[&#x27;Sample class&#x27;]])
X_encoded_df = pd.DataFrame(X_encoded, columns=encoder.get_feature_names_out([&#x27;Sample class&#x27;]))
X = pd.concat([X.drop(columns=[&#x27;Sample class&#x27;]), X_encoded_df], axis=1)

# Use SMOTE to oversample the minority class
smote = SMOTE(random_state=42)
X_resampled, y_resampled = smote.fit_resample(X, y)

# Define the model
scale_pos_weight = y.value_counts()[0] / y.value_counts()[1]
model = XGBClassifier(scale_pos_weight=scale_pos_weight, random_state=42)

# Define the cross-validation strategy
cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)

# Evaluate the model
metrics = [&#x27;accuracy&#x27;, &#x27;f1&#x27;, &#x27;precision&#x27;, &#x27;recall&#x27;]
for metric in metrics:
    scores = cross_val_score(model, X_resampled, y_resampled, cv=cv, scoring=metric)
    print(f&quot;Mean {metric}: {scores.mean():.4f}&quot;)

# Train the final model
model.fit(X_resampled, y_resampled)

# Save the model
joblib.dump(model, &#x27;water_quality_model_xgb.joblib&#x27;)

print(&quot;\nModel training complete. Model saved to water_quality_model_xgb.joblib&quot;)
</code></pre>
    
    <h2>Output</h2>
    <pre class="output"><code>Mean accuracy: 0.8344
Mean f1: 0.8578
Mean precision: 0.7514
Mean recall: 0.9994

Model training complete. Model saved to water_quality_model_xgb.joblib
</code></pre>

</body>
</html>
